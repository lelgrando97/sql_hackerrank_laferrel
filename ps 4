/*
problem set 4
*/
select 
    w.id,
    p.age,
    w.coins_needed,
    w.power
from wands w
join wands_property p
    on w.code = p.code
where p.is_evil = 0
and w.coins_needed = (
    select min(w2.coins_needed)
    from wands w2
    join wands_property p2
        on w2.code = p2.code
    where p2.age = p.age
    and w2.power = w.power
    and p2.is_evil = 0
)
order by w.power desc, p.age desc;
